# Architecture SystÃ¨me TKF - Django + React

## ğŸ“ Vue d'ensemble complÃ¨te

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COUCHE PRÃ‰SENTATION                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  React 18 (Frontend)                                     â”‚  â”‚
â”‚  â”‚  - TypeScript                                             â”‚  â”‚
â”‚  â”‚  - Redux Toolkit (State Management)                       â”‚  â”‚
â”‚  â”‚  - Material-UI (Components)                               â”‚  â”‚
â”‚  â”‚  - Vite (Build Tool)                                      â”‚  â”‚
â”‚  â”‚  Deployed: http://localhost:3000                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTP/REST
                              â”‚ JSON API Calls
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      COUCHE API/GATEWAY                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Nginx Reverse Proxy                                     â”‚  â”‚
â”‚  â”‚  - Port: 80, 443                                          â”‚  â”‚
â”‚  â”‚  - Rate Limiting                                          â”‚  â”‚
â”‚  â”‚  - SSL/TLS Termination                                    â”‚  â”‚
â”‚  â”‚  - Load Balancing                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Django Backend          â”‚  â”‚  Celery Workers          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Port: 8000         â”‚  â”‚  â”‚  â”‚ Async Tasks        â”‚  â”‚
â”‚  â”‚ Gunicorn (4 workers)  â”‚  â”‚  â”‚ - Emails           â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚  â”‚  â”‚ - SMS              â”‚  â”‚
â”‚  â”‚ Apps:              â”‚  â”‚  â”‚  â”‚ - Payments         â”‚  â”‚
â”‚  â”‚ - users/           â”‚  â”‚  â”‚  â”‚ - Reports          â”‚  â”‚
â”‚  â”‚ - cities/          â”‚  â”‚  â”‚  â”‚ - Reminders        â”‚  â”‚
â”‚  â”‚ - vehicles/        â”‚  â”‚  â”‚  â”‚ - Archive          â”‚  â”‚
â”‚  â”‚ - employees/       â”‚  â”‚  â”‚  â”‚ - Cleanup          â”‚  â”‚
â”‚  â”‚ - trips/           â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ - tickets/         â”‚  â”‚  â”‚                            â”‚
â”‚  â”‚ - parcels/         â”‚  â”‚  â”‚  Celery Beat              â”‚
â”‚  â”‚ - payments/        â”‚  â”‚  â”‚  (Scheduler)              â”‚
â”‚  â”‚ - revenues/        â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ - common/          â”‚  â”‚  â”‚  â”‚ Scheduled Tasks:   â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚  â”‚  â”‚ - Generate Reports â”‚  â”‚
â”‚  â”‚ Features:          â”‚  â”‚  â”‚  â”‚ - Daily Cleanup    â”‚  â”‚
â”‚  â”‚ - JWT Auth         â”‚  â”‚  â”‚  â”‚ - Maintenance      â”‚  â”‚
â”‚  â”‚ - RBAC             â”‚  â”‚  â”‚  â”‚ - Archive          â”‚  â”‚
â”‚  â”‚ - DRF Serializers  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ - Swagger/OpenAPI  â”‚  â”‚  â”‚                            â”‚
â”‚  â”‚ - Input Validation â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ - Error Handling   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚              â”‚              â”‚
      â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ â”‚ Redis Cache  â”‚ â”‚ Redis Broker â”‚
â”‚ (DB)         â”‚ â”‚ (Session mgmt)  â”‚ (Celery)   â”‚
â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ Port: 5432   â”‚ â”‚ Port: 6379   â”‚ â”‚ Port: 6379   â”‚
â”‚              â”‚ â”‚              â”‚ â”‚ DB: 1        â”‚
â”‚ â€¢ users      â”‚ â”‚ â€¢ Query Cacheâ”‚ â”‚              â”‚
â”‚ â€¢ cities     â”‚ â”‚ â€¢ Sessions   â”‚ â”‚ Result DB: 2 â”‚
â”‚ â€¢ vehicles   â”‚ â”‚ â€¢ Token BL   â”‚ â”‚              â”‚
â”‚ â€¢ employees  â”‚ â”‚ â€¢ Rate Limitsâ”‚ â”‚              â”‚
â”‚ â€¢ trips      â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ â€¢ tickets    â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ â€¢ parcels    â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ â€¢ payments   â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ â€¢ revenues   â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ â€¢ audit_logs â”‚ â”‚              â”‚ â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flux de RequÃªte ComplÃ¨te

### 1ï¸âƒ£ RequÃªte HTTP (Frontend â†’ Backend)

```
User â†’ React Client (Port 3000)
         â†“
      Redux Store Update
         â†“
      HTTP Request (GET /api/v1/trips/)
         â†“
      Axios Interceptor (Add JWT Token)
         â†“
      Nginx (Port 80/443)
         â†“
      Django WSGI Server (Port 8000)
```

### 2ï¸âƒ£ Traitement dans Django

```
Django Request Handler
    â†“
URL Router (/api/v1/trips/) â†’ ViewSet
    â†“
Authentication Middleware (Verify JWT)
    â†“
Permission Check (RBAC)
    â†“
View Logic (viewsets.py)
    â†“
Serializer Validation
    â†“
Database Query (ORM Django)
    â†“
Cache Check (Redis)
    â†“
Response Serialization (JSON)
    â†“
Response Middleware
    â†“
Return to Client
```

### 3ï¸âƒ£ TÃ¢che Asynchrone (Celery)

```
HTTP Request (POST /api/v1/payments/)
    â†“
Django View (Save Payment to DB)
    â†“
Celery Task (Async)
    â†“
Task published â†’ Redis Broker
    â†“
Celery Worker picks up task
    â†“
Task Execution (Send Email, Process Payment)
    â†“
Result stored in Redis
    â†“
Frontend polls or receives WebSocket update
    â†“
UI Updates with result
```

## ğŸ—„ï¸ SchÃ©ma Base de DonnÃ©es (SimplifiÃ©)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USERS & AUTH                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ users (PK: id)                                           â”‚
â”‚ â”œâ”€ id (BigInt, Primary Key)                             â”‚
â”‚ â”œâ”€ email (Unique, Email)                                â”‚
â”‚ â”œâ”€ first_name, last_name (Char)                         â”‚
â”‚ â”œâ”€ phone_number (Unique, Char)                          â”‚
â”‚ â”œâ”€ password_hash (Char)                                 â”‚
â”‚ â”œâ”€ role (Choice: ADMIN, MANAGER, DRIVER, ...)           â”‚
â”‚ â”œâ”€ is_active (Boolean)                                  â”‚
â”‚ â”œâ”€ is_verified (Boolean)                                â”‚
â”‚ â”œâ”€ created_at, updated_at (DateTime)                    â”‚
â”‚ â””â”€ deleted_at (DateTime, Soft Delete)                   â”‚
â”‚                                                          â”‚
â”‚ employees (FK: user_id)                                 â”‚
â”‚ â”œâ”€ id (BigInt, Primary Key)                             â”‚
â”‚ â”œâ”€ user_id (FK â†’ users)                                 â”‚
â”‚ â”œâ”€ employee_id (Unique, Char)                           â”‚
â”‚ â”œâ”€ position (Choice: DRIVER, CASHIER, CONTROLLER, ...)  â”‚
â”‚ â”œâ”€ salary (Decimal)                                      â”‚
â”‚ â”œâ”€ hire_date (Date)                                      â”‚
â”‚ â”œâ”€ license_number, license_expiry (Char, Date)          â”‚
â”‚ â””â”€ is_available (Boolean)                               â”‚
â”‚                                                          â”‚
â”‚ audit_logs (No FK, Log Table)                           â”‚
â”‚ â”œâ”€ id (BigInt, Primary Key)                             â”‚
â”‚ â”œâ”€ user_id (Char)                                       â”‚
â”‚ â”œâ”€ action (Char: CREATE, UPDATE, DELETE)                â”‚
â”‚ â”œâ”€ model (Char: Trip, Ticket, ...)                      â”‚
â”‚ â”œâ”€ old_values, new_values (JSON)                        â”‚
â”‚ â””â”€ timestamp (DateTime)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LOCATIONS & ROUTES                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ cities (PK: id)                                          â”‚
â”‚ â”œâ”€ id, name, code, latitude, longitude                  â”‚
â”‚ â”œâ”€ population, country                                  â”‚
â”‚ â””â”€ is_active (Boolean)                                  â”‚
â”‚                                                          â”‚
â”‚ routes (PK: id, FK: city_origin, city_destination)     â”‚
â”‚ â”œâ”€ id, name, distance_km, estimated_duration            â”‚
â”‚ â”œâ”€ city_origin_id (FK â†’ cities)                         â”‚
â”‚ â”œâ”€ city_destination_id (FK â†’ cities)                    â”‚
â”‚ â”œâ”€ base_fare (Decimal)                                  â”‚
â”‚ â”œâ”€ is_active (Boolean)                                  â”‚
â”‚ â””â”€ created_at, updated_at (DateTime)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VEHICLES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ vehicles (PK: id)                                        â”‚
â”‚ â”œâ”€ id, registration_number (Unique), model              â”‚
â”‚ â”œâ”€ capacity (Int), year (Year)                          â”‚
â”‚ â”œâ”€ status (Choice: ACTIVE, MAINTENANCE, RETIRED)        â”‚
â”‚ â”œâ”€ last_inspection_date (Date)                          â”‚
â”‚ â”œâ”€ insurance_expiry_date (Date)                         â”‚
â”‚ â”œâ”€ fuel_consumption_per_km (Decimal)                    â”‚
â”‚ â””â”€ created_at, updated_at (DateTime)                    â”‚
â”‚                                                          â”‚
â”‚ vehicle_maintenance (FK: vehicle_id)                    â”‚
â”‚ â”œâ”€ id, vehicle_id (FK â†’ vehicles)                       â”‚
â”‚ â”œâ”€ maintenance_type (Choice: OIL, TIRES, ...)           â”‚
â”‚ â”œâ”€ date, cost, description                              â”‚
â”‚ â””â”€ next_maintenance_date (Date)                         â”‚
â”‚                                                          â”‚
â”‚ fuel_logs (FK: vehicle_id)                              â”‚
â”‚ â”œâ”€ id, vehicle_id (FK â†’ vehicles)                       â”‚
â”‚ â”œâ”€ liters (Decimal), cost (Decimal)                     â”‚
â”‚ â”œâ”€ date (DateTime), odometer_reading (Int)              â”‚
â”‚ â””â”€ created_at (DateTime)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TRIPS & TICKETS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ trips (PK: id)                                           â”‚
â”‚ â”œâ”€ id, route_id (FK â†’ routes)                           â”‚
â”‚ â”œâ”€ vehicle_id (FK â†’ vehicles)                           â”‚
â”‚ â”œâ”€ departure_datetime, arrival_datetime                 â”‚
â”‚ â”œâ”€ status (Choice: PLANNED, IN_PROGRESS, COMPLETED)     â”‚
â”‚ â”œâ”€ available_seats (Int), price_per_seat (Decimal)      â”‚
â”‚ â”œâ”€ driver_id (FK â†’ employees)                           â”‚
â”‚ â”œâ”€ cashier_id (FK â†’ employees, nullable)                â”‚
â”‚ â””â”€ created_at, updated_at (DateTime)                    â”‚
â”‚                                                          â”‚
â”‚ trip_employees (M2M: trip_id, employee_id)             â”‚
â”‚ â”œâ”€ trip_id (FK â†’ trips)                                 â”‚
â”‚ â”œâ”€ employee_id (FK â†’ employees)                         â”‚
â”‚ â”œâ”€ role (Choice: DRIVER, CASHIER, CONTROLLER)           â”‚
â”‚ â””â”€ assigned_at (DateTime)                               â”‚
â”‚                                                          â”‚
â”‚ tickets (PK: id)                                         â”‚
â”‚ â”œâ”€ id, trip_id (FK â†’ trips)                             â”‚
â”‚ â”œâ”€ user_id (FK â†’ users)                                 â”‚
â”‚ â”œâ”€ ticket_number (Unique), seat_number                  â”‚
â”‚ â”œâ”€ price (Decimal), status (VALID, USED, CANCELLED)     â”‚
â”‚ â”œâ”€ qr_code (Char), barcode (Char)                       â”‚
â”‚ â”œâ”€ purchased_at, boarded_at (DateTime)                  â”‚
â”‚ â”œâ”€ payment_id (FK â†’ payments)                           â”‚
â”‚ â””â”€ created_at, updated_at (DateTime)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PARCELS & SHIPPING                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ parcels (PK: id)                                         â”‚
â”‚ â”œâ”€ id, parcel_number (Unique), description              â”‚
â”‚ â”œâ”€ weight (Decimal), dimensions (Char)                  â”‚
â”‚ â”œâ”€ sender_id (FK â†’ users)                               â”‚
â”‚ â”œâ”€ receiver_id (FK â†’ users)                             â”‚
â”‚ â”œâ”€ origin_city_id, destination_city_id (FK â†’ cities)    â”‚
â”‚ â”œâ”€ price (Decimal), status (REGISTERED, IN_TRANSIT, ...) â”‚
â”‚ â”œâ”€ insurance_value (Decimal, nullable)                  â”‚
â”‚ â””â”€ created_at, updated_at (DateTime)                    â”‚
â”‚                                                          â”‚
â”‚ parcel_shipments (FK: parcel_id)                        â”‚
â”‚ â”œâ”€ id, parcel_id (FK â†’ parcels)                         â”‚
â”‚ â”œâ”€ trip_id (FK â†’ trips)                                 â”‚
â”‚ â”œâ”€ status, shipped_date (DateTime)                      â”‚
â”‚ â”œâ”€ delivered_date, signature (DateTime, Char)           â”‚
â”‚ â””â”€ current_location (Char)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PAYMENTS & REVENUE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ payments (PK: id)                                        â”‚
â”‚ â”œâ”€ id, payment_id (Unique), amount (Decimal)            â”‚
â”‚ â”œâ”€ payment_method (Choice: CASH, CARD, MOBILE_MONEY)    â”‚
â”‚ â”œâ”€ status (Choice: PENDING, COMPLETED, FAILED)          â”‚
â”‚ â”œâ”€ user_id (FK â†’ users)                                 â”‚
â”‚ â”œâ”€ transaction_id (Unique, Char)                        â”‚
â”‚ â”œâ”€ paid_at (DateTime)                                   â”‚
â”‚ â”œâ”€ receipt_number (Unique, Char)                        â”‚
â”‚ â””â”€ created_at, updated_at (DateTime)                    â”‚
â”‚                                                          â”‚
â”‚ revenue_logs (No FK, Log Table)                         â”‚
â”‚ â”œâ”€ id, date (Date)                                      â”‚
â”‚ â”œâ”€ trip_revenue, parcel_revenue (Decimal)               â”‚
â”‚ â”œâ”€ expenses (Decimal), net_revenue (Decimal)            â”‚
â”‚ â”œâ”€ payment_method_breakdown (JSON)                      â”‚
â”‚ â””â”€ created_at (DateTime)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Flux Authentification JWT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LOGIN FLOW                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. User enters credentials                             â”‚
â”‚     â†“                                                    â”‚
â”‚  2. POST /api/v1/auth/login                             â”‚
â”‚     {email: "user@example.com", password: "..."}        â”‚
â”‚     â†“                                                    â”‚
â”‚  3. Backend validates (bcrypt check)                    â”‚
â”‚     â†“                                                    â”‚
â”‚  4. Generate Tokens:                                    â”‚
â”‚     - Access Token (1 hour) - For API calls             â”‚
â”‚     - Refresh Token (7 days) - For renewing access      â”‚
â”‚     â†“                                                    â”‚
â”‚  5. Return to Frontend:                                 â”‚
â”‚     {                                                   â”‚
â”‚       "access": "eyJhbGc...",                           â”‚
â”‚       "refresh": "eyJhbGc..."                           â”‚
â”‚     }                                                    â”‚
â”‚     â†“                                                    â”‚
â”‚  6. Frontend stores in localStorage                     â”‚
â”‚                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                  API CALL FLOW                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                          â”‚
â”‚  1. Frontend makes API call                             â”‚
â”‚     GET /api/v1/trips/                                  â”‚
â”‚     Header: Authorization: Bearer <access_token>        â”‚
â”‚     â†“                                                    â”‚
â”‚  2. Nginx forwards to Django                            â”‚
â”‚     â†“                                                    â”‚
â”‚  3. Middleware extracts token from header               â”‚
â”‚     â†“                                                    â”‚
â”‚  4. Verify JWT signature & expiration                   â”‚
â”‚     â†“                                                    â”‚
â”‚  5. Extract user_id from token payload                  â”‚
â”‚     â†“                                                    â”‚
â”‚  6. Load User and check permissions (RBAC)              â”‚
â”‚     â†“                                                    â”‚
â”‚  7. Execute view logic if authorized                    â”‚
â”‚     â†“                                                    â”‚
â”‚  8. Return response (200, 401, 403)                     â”‚
â”‚                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚              REFRESH TOKEN FLOW                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                          â”‚
â”‚  1. Access token expired (error 401)                    â”‚
â”‚     â†“                                                    â”‚
â”‚  2. Frontend sends refresh token                        â”‚
â”‚     POST /api/v1/auth/refresh/                          â”‚
â”‚     {refresh: "eyJhbGc..."}                             â”‚
â”‚     â†“                                                    â”‚
â”‚  3. Backend validates refresh token                     â”‚
â”‚     â†“                                                    â”‚
â”‚  4. Issue new access token                              â”‚
â”‚     â†“                                                    â”‚
â”‚  5. Return new access token                             â”‚
â”‚     â†“                                                    â”‚
â”‚  6. Frontend retries original request with new token    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ DÃ©ploiement Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 PRODUCTION DEPLOYMENT                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Users (Internet)                                         â”‚
â”‚     â”‚                                                      â”‚
â”‚     â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ CloudFlare / CDN (Static Assets)                     â”‚â”‚
â”‚  â”‚ - Cache CSS, JS, Images                              â”‚â”‚
â”‚  â”‚ - DDoS Protection                                     â”‚â”‚
â”‚  â”‚ - SSL/TLS                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚     â”‚                                                      â”‚
â”‚     â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Load Balancer (AWS / Azure / Digital Ocean)          â”‚â”‚
â”‚  â”‚ - Distribute traffic across servers                   â”‚â”‚
â”‚  â”‚ - Health checks                                       â”‚â”‚
â”‚  â”‚ - Auto-scaling                                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚     â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â–¼          â–¼          â–¼          â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Kubernetes Cluster (Orchestration)                   â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚â”‚
â”‚  â”‚ â”‚ Pod 1   â”‚ â”‚ Pod 2   â”‚ â”‚ Pod N   â”‚                  â”‚â”‚
â”‚  â”‚ â”‚ Django  â”‚ â”‚ Django  â”‚ â”‚ Django  â”‚                  â”‚â”‚
â”‚  â”‚ â”‚ Nginx   â”‚ â”‚ Nginx   â”‚ â”‚ Nginx   â”‚                  â”‚â”‚
â”‚  â”‚ â”‚ React   â”‚ â”‚ React   â”‚ â”‚ React   â”‚                  â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚â”‚
â”‚  â”‚                                                        â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚â”‚
â”‚  â”‚ â”‚ Worker  â”‚ â”‚ Worker  â”‚ â”‚ Worker  â”‚                  â”‚â”‚
â”‚  â”‚ â”‚ Celery  â”‚ â”‚ Celery  â”‚ â”‚ Celery  â”‚                  â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚â”‚
â”‚  â”‚                                                        â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚â”‚
â”‚  â”‚ â”‚ Persistent Storage                  â”‚               â”‚â”‚
â”‚  â”‚ â”‚ - PostgreSQL (Managed Service)      â”‚               â”‚â”‚
â”‚  â”‚ â”‚ - Redis (Managed Service)           â”‚               â”‚â”‚
â”‚  â”‚ â”‚ - S3 Storage (File uploads)         â”‚               â”‚â”‚
â”‚  â”‚ â”‚ - EBS Volumes (Data persistence)    â”‚               â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚     â”‚                                                      â”‚
â”‚     â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Monitoring & Logging                                 â”‚â”‚
â”‚  â”‚ - Prometheus (Metrics)                                â”‚â”‚
â”‚  â”‚ - Grafana (Dashboards)                                â”‚â”‚
â”‚  â”‚ - ELK Stack (Logs)                                    â”‚â”‚
â”‚  â”‚ - Sentry (Error tracking)                             â”‚â”‚
â”‚  â”‚ - DataDog / New Relic (APM)                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Performance & ScalabilitÃ©

### Caching Strategy
```
L1: Browser Cache (HTTP Cache Headers)
    â†“
L2: CDN Cache (CloudFlare, CloudFront)
    â†“
L3: Redis Cache (Database queries)
    â†“
L4: Database Cache (PostgreSQL Query Cache)
    â†“
L5: Database (Final source of truth)
```

### Database Optimization
- Indexes on FK columns, status, date ranges
- Partitioning for large tables (trips, payments)
- Connection pooling (PgBouncer)
- Read replicas for scaling reads
- Regular VACUUM & ANALYZE

### API Response Optimization
- Pagination (50 items per page)
- Selective field loading
- Gzip compression
- JSON serialization optimization
- Query select_related / prefetch_related

---

**Version**: 1.0  
**Date**: DÃ©cembre 2024  
**Architecture**: Django 4.2 LTS + React 18 + PostgreSQL
